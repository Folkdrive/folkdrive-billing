{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice {{ invoice.invoice_number }} - Folkdrive Solutions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @page {
            size: A4;
            margin: 15mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #1e293b;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .invoice-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }

        .invoice-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        }
        
        .invoice-content {
            padding: 40px;
        }
        
        /* Header Section */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 3px double #e2e8f0;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 30px;
            border-radius: 15px;
            margin: -40px -40px 40px -40px;
        }
        
        .company-info {
            flex: 2;
        }
        
        .invoice-info {
            flex: 1;
            text-align: right;
        }
        
        .company-name {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .company-tagline {
            font-size: 16px;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .company-details {
            color: #475569;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .invoice-title {
            font-size: 36px;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 15px;
        }
        
        .invoice-number {
            font-size: 20px;
            font-weight: 700;
            color: #475569;
            margin-bottom: 10px;
        }
        
        .invoice-meta {
            color: #64748b;
            font-size: 14px;
        }

        /* GST Details Section */
        .gst-section {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 6px solid #3b82f6;
        }

        .gst-title {
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gst-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            font-size: 14px;
        }

        .gst-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gst-label {
            font-weight: 600;
            color: #475569;
        }

        .gst-value {
            color: #1e293b;
            font-weight: 500;
        }

        /* Details Grid */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 35px;
        }
        
        .detail-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 6px solid #3b82f6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .detail-label {
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 12px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-value {
            font-size: 15px;
            color: #1e293b;
            line-height: 1.7;
        }

        .detail-value strong {
            color: #1e40af;
            font-size: 16px;
        }

        /* Amounts Table */
        .amounts-section {
            margin: 35px 0;
        }

        .amounts-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .amounts-table th {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 700;
            font-size: 15px;
        }
        
        .amounts-table td {
            padding: 18px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 15px;
        }
        
        .amounts-table tr:last-child td {
            border-bottom: none;
        }
        
        .total-row {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: white;
            font-weight: 700;
            font-size: 17px;
        }

        .total-row td {
            border: none !important;
        }

        .discount-row {
            background: #fef2f2;
            color: #dc2626;
        }

        .subtotal-row {
            background: #f0f9ff;
            font-weight: 600;
        }

        /* GST Breakdown */
        .gst-breakup {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 6px solid #10b981;
        }
        
        .gst-breakup-title {
            font-weight: 700;
            color: #065f46;
            margin-bottom: 15px;
            font-size: 17px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .gst-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .gst-item-breakup {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #d1fae5;
        }

        .gst-item-label {
            font-weight: 600;
            color: #065f46;
        }

        .gst-item-value {
            font-weight: 700;
            color: #065f46;
        }

        /* Payment Section */
        .payment-section {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 6px solid #f59e0b;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .payment-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 20px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .payment-table th {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .payment-table td {
            padding: 15px;
            border-bottom: 1px solid #fef3c7;
            font-size: 14px;
        }

        .payment-table tr:last-child td {
            border-bottom: none;
        }

        .payment-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #fbbf24;
        }

        .payment-summary-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 2px solid #fbbf24;
        }

        .payment-summary-label {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .payment-summary-value {
            font-weight: 800;
            font-size: 18px;
            color: #1e293b;
        }

        .payment-summary-value.paid {
            color: #10b981;
        }

        .payment-summary-value.due {
            color: #dc2626;
        }

        /* Terms Section */
        .terms-section {
            margin-top: 35px;
            padding-top: 30px;
            border-top: 3px double #e2e8f0;
        }
        
        .terms-label {
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 17px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .terms-content {
            color: #475569;
            font-size: 14px;
            line-height: 1.7;
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
        }

        /* Bank Details */
        .bank-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 25px;
            border-radius: 15px;
            margin-top: 30px;
            border-left: 6px solid #0369a1;
        }

        .bank-label {
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 15px;
            font-size: 17px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bank-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            font-size: 14px;
        }

        .bank-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bank-item-label {
            font-weight: 600;
            color: #475569;
        }

        .bank-item-value {
            color: #1e293b;
            font-weight: 500;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            text-align: center;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
            color: #64748b;
            font-size: 13px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 25px;
            border-radius: 15px;
        }

        .footer-message {
            font-style: italic;
            margin-top: 10px;
            color: #94a3b8;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status-paid { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .status-pending { 
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .status-overdue { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .status-sent {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        /* Print Controls */
        .no-print {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
        }

        .print-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        .close-btn {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.4);
        }

        .close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.6);
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none;
            }
            
            body {
                background: white !important;
                padding: 0 !important;
            }
            
            .invoice-container {
                border: none !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                margin: 0 !important;
                max-width: none !important;
            }

            .invoice-content {
                padding: 0 !important;
            }

            .header {
                margin: 0 !important;
                border-radius: 0 !important;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .invoice-content {
                padding: 20px;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .invoice-info {
                text-align: center;
            }

            .details-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .gst-details,
            .bank-details {
                grid-template-columns: 1fr;
            }

            .payment-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="invoice-content">
            <!-- Header Section -->
            <div class="header">
                <div class="company-info">
                    <div class="company-name">
                        <i class="fas fa-rocket"></i>
                        FOLKDRIVE SOLUTIONS
                    </div>
                    <div class="company-tagline">Innovative Technology Solutions</div>
                    <div class="company-details">
                        <i class="fas fa-map-marker-alt"></i> No 8, 3479, Gayathri Nagar, C Block, Bangalore 560021<br>
                        <i class="fas fa-phone"></i> +91-9916245531 | 
                        <i class="fas fa-envelope"></i> info@folkdrive.in<br>
                        <i class="fas fa-id-card"></i> GSTIN: 29AAECF3447K1ZB
                    </div>
                </div>
                
                <div class="invoice-info">
                    <div class="invoice-title">TAX INVOICE</div>
                    <div class="invoice-number">{{ invoice.invoice_number }}</div>
                    <div class="invoice-meta">
                        <i class="fas fa-calendar"></i> Date: {{ invoice.invoice_date|date:"F d, Y" }}<br>
                        <i class="fas fa-hourglass-end"></i> Due: {{ invoice.due_date|date:"F d, Y" }}<br>
                        <span class="status-badge status-{{ invoice.status }}">
                            <i class="fas fa-{% if invoice.status == 'paid' %}check-circle{% elif invoice.status == 'overdue' %}exclamation-triangle{% else %}clock{% endif %}"></i>
                            {{ invoice.get_status_display|upper }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- GST Details Section -->
            <div class="gst-section">
                <div class="gst-title">
                    <i class="fas fa-file-invoice-dollar"></i>
                    GST & SERVICE DETAILS
                </div>
                <div class="gst-details">
                    <div class="gst-item">
                        <span class="gst-label">HSN Code:</span>
                        <span class="gst-value">{{ invoice.hsn_code }}</span>
                    </div>
                    <div class="gst-item">
                        <span class="gst-label">SAC Code:</span>
                        <span class="gst-value">{{ invoice.sac_code }}</span>
                    </div>
                    <div class="gst-item">
                        <span class="gst-label">Place of Supply:</span>
                        <span class="gst-value">{{ invoice.place_of_supply }}</span>
                    </div>
                    <div class="gst-item">
                        <span class="gst-label">Service Type:</span>
                        <span class="gst-value">{% if invoice.is_service %}Service{% else %}Goods{% endif %}</span>
                    </div>
                </div>
            </div>

            <!-- Customer and Project Details -->
            <div class="details-grid">
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-building"></i>
                        BILL TO:
                    </div>
                    <div class="detail-value">
                        <strong>{{ invoice.customer.company_name }}</strong><br>
                        <i class="fas fa-map-marker-alt"></i> {{ invoice.customer.address }}<br>
                        {{ invoice.customer.branch_location }}<br>
                        <i class="fas fa-id-card"></i> GSTIN: {{ invoice.customer.gst_number }}<br>
                        <i class="fas fa-user"></i> Contact: {{ invoice.customer.contact_name }}<br>
                        <i class="fas fa-phone"></i> Phone: {{ invoice.customer.mobile_number }}<br>
                        <i class="fas fa-envelope"></i> Email: {{ invoice.customer.email }}
                    </div>
                </div>
                
                <div class="detail-card">
                    <div class="detail-label">
                        <i class="fas fa-tasks"></i>
                        PROJECT DETAILS:
                    </div>
                    <div class="detail-value">
                        <strong>{{ invoice.work_order.project_title }}</strong><br>
                        {{ invoice.work_order.project_description|default:"No description provided" }}<br>
                        <i class="fas fa-file-invoice"></i> Work Order: {{ invoice.work_order.work_order_number }}
                    </div>
                </div>
            </div>

            <!-- Amount Breakdown -->
            <div class="amounts-section">
                <table class="amounts-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Amount (₹)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><i class="fas fa-money-bill-wave"></i> Base Amount</td>
                            <td>₹{{ invoice.base_amount|floatformat:2 }}</td>
                        </tr>
                        {% if invoice.work_order.discount_amount > 0 %}
                        <tr class="discount-row">
                            <td><i class="fas fa-tag"></i> Discount ({{ invoice.work_order.discount }}%)</td>
                            <td>-₹{{ invoice.work_order.discount_amount|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                        <tr class="subtotal-row">
                            <td><i class="fas fa-calculator"></i> Subtotal</td>
                            <td>₹{{ invoice.subtotal|floatformat:2 }}</td>
                        </tr>
                        
                        <!-- GST Breakdown -->
                        {% if invoice.place_of_supply == 'Gujarat' %}
                        <tr>
                            <td><i class="fas fa-receipt"></i> CGST ({{ invoice.cgst_rate }}%)</td>
                            <td>₹{{ invoice.cgst_amount|floatformat:2 }}</td>
                        </tr>
                        <tr>
                            <td><i class="fas fa-receipt"></i> SGST ({{ invoice.sgst_rate }}%)</td>
                            <td>₹{{ invoice.sgst_amount|floatformat:2 }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td><i class="fas fa-receipt"></i> IGST ({{ invoice.igst_rate }}%)</td>
                            <td>₹{{ invoice.igst_amount|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                        
                        <tr class="total-row">
                            <td><i class="fas fa-file-invoice-dollar"></i> TOTAL AMOUNT</td>
                            <td><strong>₹{{ invoice.total_amount|floatformat:2 }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Payment Information -->
            {% if invoice.payments.exists %}
            <div class="payment-section">
                <div class="payment-title">
                    <i class="fas fa-credit-card"></i>
                    PAYMENT RECEIVED
                </div>
                <table class="payment-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Method</th>
                            <th>Reference</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in invoice.payments.all %}
                        <tr>
                            <td><i class="fas fa-calendar"></i> {{ payment.payment_date|date:"M d, Y" }}</td>
                            <td><strong>₹{{ payment.amount|floatformat:2 }}</strong></td>
                            <td>{{ payment.get_payment_method_display }}</td>
                            <td>{{ payment.reference_number|default:"-" }}</td>
                            <td>
                                <span class="status-badge status-paid">
                                    <i class="fas fa-check-circle"></i>
                                    {{ payment.get_status_display|upper }}
                                </span>
                            </td>
                        </tr>
                        {% if payment.notes %}
                        <tr>
                            <td colspan="5" style="font-size: 12px; color: #666; background: #fefce8;">
                                <strong><i class="fas fa-sticky-note"></i> Notes:</strong> {{ payment.notes }}
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                
                <div class="payment-summary">
                    <div class="payment-summary-item">
                        <div class="payment-summary-label">Total Amount</div>
                        <div class="payment-summary-value">₹{{ invoice.total_amount|floatformat:2 }}</div>
                    </div>
                    <div class="payment-summary-item">
                        <div class="payment-summary-label">Amount Paid</div>
                        <div class="payment-summary-value paid">₹{{ invoice.amount_paid|floatformat:2 }}</div>
                    </div>
                    <div class="payment-summary-item">
                        <div class="payment-summary-label">Balance Due</div>
                        <div class="payment-summary-value due">₹{{ invoice.balance_due|floatformat:2 }}</div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Terms and Conditions -->
            {% if invoice.terms_and_conditions %}
            <div class="terms-section">
                <div class="terms-label">
                    <i class="fas fa-file-contract"></i>
                    TERMS & CONDITIONS:
                </div>
                <div class="terms-content">
                    {{ invoice.terms_and_conditions|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Bank Details -->
            <div class="bank-section">
                <div class="bank-label">
                    <i class="fas fa-university"></i>
                    BANK DETAILS
                </div>
                <div class="bank-details">
                    <div class="bank-item">
                        <span class="bank-item-label">Bank:</span>
                        <span class="bank-item-value">STATE BANK OF INDIA</span>
                    </div>
                    <div class="bank-item">
                        <span class="bank-item-label">Account Holder:</span>
                        <span class="bank-item-value">Folkdrive India Private Limited</span>
                    </div>
                    <div class="bank-item">
                        <span class="bank-item-label">Account Number:</span>
                        <span class="bank-item-value">42583437839</span>
                    </div>
                    <div class="bank-item">
                        <span class="bank-item-label">IFSC Code:</span>
                        <span class="bank-item-value">SBIN0064074</span>
                    </div>
                    <div class="bank-item">
                        <span class="bank-item-label">Branch:</span>
                        <span class="bank-item-value">START UP BRANCH</span>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <div class="detail-value">
                    <strong>Thank you for your business!</strong><br>
                    We appreciate your trust in Folkdrive Solutions.
                </div>
                <div class="footer-message">
                    <i class="fas fa-laptop"></i> This is a computer-generated invoice and does not require a physical signature.
                </div>
            </div>
        </div>
    </div>

    <!-- Print Controls -->
    <div class="no-print">
        <button onclick="window.print()" class="print-btn">
            <i class="fas fa-print"></i> Print Invoice
        </button>
        
        <button onclick="window.close()" class="close-btn">
            <i class="fas fa-times"></i> Close Window
        </button>
    </div>

    <script>
        // Auto-print option (optional)
        window.onload = function() {
            // Uncomment the line below if you want to auto-print
            // setTimeout(() => { window.print(); }, 1000);
        };

        // Add smooth interactions for buttons
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.print-btn, .close-btn');
            
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            console.log('Enhanced invoice print template loaded successfully');
        });
    </script>
</body>
</html>